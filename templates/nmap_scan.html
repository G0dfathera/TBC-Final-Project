{% extends 'base.html' %}

{% block content %}
<div class="container mt-5">
    <!-- Page Header -->
    <h1 class="text-center mb-4 display-4 font-weight-bold text-primary">
        Nmap Scan
    </h1>

    <!-- Nmap Scan Form -->
    <form method="POST" action="{{ url_for('nmap_scan') }}">
        <div class="card shadow-lg rounded-lg border-primary">
            <div class="card-body">
                <h4 class="card-title mb-4 text-dark font-weight-bold">Configure Your Scan</h4>

                <div class="form-group">
                    <label for="target_ip" class="h5 text-primary">Target IP/Web Address</label>
                    <input
                        type="text"
                        class="form-control form-control-lg rounded-pill shadow-sm"
                        id="target_ip"
                        name="target_ip"
                        placeholder="Example: 8.8.8.8 or google.com"
                        required
                    />
                    <small class="form-text text-muted">Enter an IP or domain to scan (e.g. 8.8.8.8 or google.com).</small>
                </div>

                <div class="form-group mt-4">
                    <label for="scan_depth" class="h5 text-primary">Select Scan Depth</label>
                    <select
                        class="form-control form-control-lg rounded-pill shadow-sm"
                        id="scan_depth"
                        name="scan_depth"
                        required
                    >
                        <option value="basic">Basic Scan</option>
                        <option value="service">Service Version Detection</option>
                    </select>
                    <small class="form-text text-muted">Choose the level of scanning you'd like to perform.</small>
                </div>

                <button
                    type="submit"
                    class="btn btn-primary btn-lg btn-block rounded-pill mt-4 shadow-sm"
                >
                    Run Scan
                </button>
            </div>
        </div>
    </form>

    <!-- Display Scan Results -->
    {% if scan_result %}
    <hr class="my-4" />
    <div class="card mt-4 shadow-lg rounded-lg border-info">
        <div class="card-body">
            <h4 class="card-title text-dark font-weight-bold">Scan Results</h4>

            {% if scan_result['scan'] %}
                <p class="font-weight-bold">Target: {{ scan_result['scan'].keys() | first }}</p>
                <p><strong>Status:</strong> {{ scan_result['scan'][scan_result['scan'].keys() | first]['status']['state'] | capitalize }}</p>

                <h5 class="mt-4 mb-3 text-primary">Open Ports</h5>
                <ul class="list-group">
                    {% for port, details in scan_result['scan'][scan_result['scan'].keys() | first]['tcp'].items() %}
                        {% if details['state'] == 'open' %}
                            <li class="list-group-item d-flex justify-content-between align-items-center"></li>
                                <strong>Port {{ port }}</strong>
                                <span class="badge badge-success badge-pill">{{ details['name'] }} - {{ details['product'] or 'Unknown Product' }}</span>
                            </li>
                        {% endif %}
                    {% endfor %}
                </ul>
            {% else %}
                <p>No open ports found or scan did not return results.</p>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
